<div class="demo-container">
  <header class="demo-header">
    <a routerLink="/signals-demo" class="back-link">← Back to Signals Demo</a>
    <h1>Live Demo: User Registration Form</h1>
    <p class="intro">Interact with a live form that demonstrates all signal concepts in action. Fill out the form and watch how signals react to your input.</p>
  </header>

  <section class="form-section">
    <form class="user-form">
      <!-- Basic Signals -->
      <div class="form-subsection">
        <h3>Basic Signals</h3>

        <div class="form-group">
          <label for="firstName">First Name (signal):</label>
          <input
            type="text"
            id="firstName"
            [value]="firstName()"
            (input)="updateFirstName($event)"
            placeholder="Enter first name"
          />
          <span class="signal-value">Signal value: {{ firstName() }}</span>
        </div>

        <div class="form-group">
          <label for="lastName">Last Name (signal):</label>
          <input
            type="text"
            id="lastName"
            [value]="lastName()"
            (input)="updateLastName($event)"
            placeholder="Enter last name"
          />
          <span class="signal-value">Signal value: {{ lastName() }}</span>
        </div>

        <div class="form-group">
          <label for="age">Age (signal):</label>
          <input
            type="number"
            id="age"
            [value]="age()"
            (input)="updateAge($event)"
            placeholder="Enter age"
            min="0"
          />
          <span class="signal-value">Signal value: {{ age() }}</span>
        </div>

        <div class="form-group">
          <label for="email">Email (signal):</label>
          <input
            type="email"
            id="email"
            [value]="email()"
            (input)="updateEmail($event)"
            placeholder="Enter email"
          />
          <span class="signal-value">Signal value: {{ email() }}</span>
        </div>
      </div>

      <!-- Computed Signals -->
      <div class="form-subsection">
        <h3>Computed Signals</h3>

        <div class="form-group computed">
          <label>Full Name (computed signal):</label>
          <div class="computed-display">
            <strong>{{ fullName() || 'Enter first and last name' }}</strong>
          </div>
          <p class="explanation">This is computed from firstName and lastName signals</p>
        </div>

        <div class="form-group computed">
          <label>Age Category (computed signal):</label>
          <div class="computed-display">
            <strong>{{ ageCategory() || 'Enter age' }}</strong>
          </div>
          <p class="explanation">Automatically computed from age signal</p>
        </div>

        <div class="form-group computed">
          <label>Form Valid (computed signal):</label>
          <div class="computed-display">
            <strong [class.valid]="isFormValid()" [class.invalid]="!isFormValid()">
              {{ isFormValid() ? '✓ Valid' : '✗ Invalid' }}
            </strong>
          </div>
          <p class="explanation">Computed from all form field signals</p>
        </div>

        <div class="form-group computed">
          <label>Form Summary (computed signal):</label>
          <div class="computed-display summary">
            <pre>{{ formSummary() | json }}</pre>
          </div>
          <p class="explanation">All form data combined in a computed signal</p>
        </div>
      </div>

      <!-- Signal with update() -->
      <div class="form-subsection">
        <h3>Signal with update()</h3>

        <div class="form-group">
          <label>User Preferences (signal with update()):</label>
          <div class="preferences">
            <button
              type="button"
              (click)="toggleNotifications()"
              [class.active]="userPreferences().notifications"
            >
              Notifications: {{ userPreferences().notifications ? 'ON' : 'OFF' }}
            </button>
            <select
              [value]="userPreferences().theme"
              (change)="updateTheme($event)"
            >
              <option value="light">Light Theme</option>
              <option value="dark">Dark Theme</option>
              <option value="auto">Auto Theme</option>
            </select>
          </div>
          <span class="signal-value">Preferences: {{ userPreferences() | json }}</span>
        </div>
      </div>

      <!-- Model Signal -->
      <div class="form-subsection">
        <h3>Model Signal (Two-way Binding)</h3>

        <div class="form-group model">
          <label>Shared Value (model signal - two-way binding):</label>
          <div class="model-demo">
            <input
              type="text"
              [value]="sharedValue()"
              (input)="updateSharedValue($event)"
              placeholder="Enter shared value"
            />
            <span class="signal-value">Model value: {{ sharedValue() }}</span>
          </div>
          <p class="explanation">This value is bound to child component via model()</p>
        </div>
      </div>

      <!-- LinkedSignal Demos -->
      <div class="form-subsection">
        <h3>LinkedSignal Examples</h3>

        <div class="form-group linked-signal">
          <label>LinkedSignal Demo (linkedDisplayValue):</label>
          <div class="linked-demo">
            <div class="linked-source">
              <label>Source (sharedValue):</label>
              <span class="signal-value">{{ sharedValue() || 'Empty' }}</span>
            </div>
            <div class="linked-target">
              <label>Linked Signal (can be edited independently):</label>
              <input
                type="text"
                [value]="linkedDisplayValue()"
                (input)="updateLinkedDisplayValue($event)"
                placeholder="Edit linked signal"
                class="linked-input"
              />
              <span class="signal-value">Linked value: {{ linkedDisplayValue() || 'Empty' }}</span>
            </div>
          </div>
          <p class="explanation">LinkedSignal reacts to source changes but can be written to independently</p>
        </div>

        <div class="form-group linked-signal">
          <label>Editable Full Name (LinkedSignal):</label>
          <div class="linked-demo">
            <div class="linked-source">
              <label>Computed Full Name:</label>
              <span class="signal-value">{{ fullName() || 'Empty' }}</span>
            </div>
            <div class="linked-target">
              <label>Editable Version:</label>
              <input
                type="text"
                [value]="editableFullName()"
                (input)="updateEditableFullName($event)"
                placeholder="Override computed name"
                class="linked-input"
              />
              <span class="signal-value">Editable: {{ editableFullName() || 'Empty' }}</span>
            </div>
          </div>
          <p class="explanation">LinkedSignal allows overriding computed values while maintaining reactivity</p>
        </div>

        <div class="form-group linked-signal">
          <label>Validated Age (LinkedSignal with validation):</label>
          <div class="linked-demo">
            <div class="linked-source">
              <label>Source Age:</label>
              <span class="signal-value">{{ age() }}</span>
            </div>
            <div class="linked-target">
              <label>Validated Age (keeps last valid value):</label>
              <span class="signal-value validated">{{ validatedAge() }}</span>
            </div>
          </div>
          <p class="explanation">LinkedSignal maintains previous valid value when source becomes invalid</p>
        </div>
      </div>

      <!-- Child Component -->
      <div class="form-subsection">
        <h3>Child Component (input/output/model signals)</h3>

        <div class="form-group child-component">
          <app-user-form
            [userName]="fullName()"
            [(sharedModel)]="sharedValue"
            (userSubmitted)="onUserSubmitted($event)"
          ></app-user-form>

          <!-- Output Signal Display -->
          @if (outputData()) {
            <div class="output-signal-display">
              <label>Received Output Signal:</label>
              <div class="output-info">
                <div class="output-item">
                  <span class="output-label">Timestamp:</span>
                  <span class="output-value">{{ formatOutputTimestamp(outputData()!.timestamp) }}</span>
                </div>
                <div class="output-item">
                  <span class="output-label">User Name:</span>
                  <span class="output-value">{{ outputData()!.userName }}</span>
                </div>
                <div class="output-item">
                  <span class="output-label">Shared Model:</span>
                  <span class="output-value">{{ outputData()!.sharedModel || 'Empty' }}</span>
                </div>
              </div>
              <div class="computed-display summary">
                <pre>{{ outputData() | json }}</pre>
              </div>
              <p class="explanation">This data was emitted from the child component via output() signal</p>
            </div>
          }
        </div>
      </div>

      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" (click)="resetForm()" class="btn-reset">Reset Form</button>
      </div>
    </form>

    <!-- Effects Info -->
    <div class="effects-info">
      <h3>Effects in Action</h3>
      <p>Open the browser console to see effects logging form changes.</p>
      <p>The document title also updates automatically when the full name changes (check the browser tab title).</p>
    </div>
  </section>
</div>
